<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CodArt'24 Challenges</title>
    <link rel="stylesheet" href="styles2.css">
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #121212; /* Very dark background for a modern look */
            color: #e0e0e0; /* Light text color */
            margin: 0;
            padding: 0;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        h1 {
            text-align: center;
            font-family: 'Roboto', sans-serif;
            font-size: 3em; /* Big heading */
            color: #1de9b6; /* Teal color for heading */
            margin-bottom: 20px;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 700;
            position: relative;
            padding-bottom: 10px;
        }
        
        h1::after {
            content: "";
            display: block;
            width: 60%;
            height: 4px;
            background: #e0e0e0;
            margin: 10px auto 0;
            border-radius: 2px;
            transform: scaleX(0);
            transition: transform 0.5s ease-in-out;
        }
        
        h1:hover::after {
            transform: scaleX(1);
        }
        
        .challenge {
            position: relative;
            padding: 20px;
            margin: 15px 0;
            border: 1px solid #333;
            border-radius: 8px;
            background-color: #1c1c1c; /* Dark background for challenges */
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
            transition: transform 0.3s, box-shadow 0.3s, border-color 0.3s;
        }
        
        .challenge:hover {
            transform: scale(1.02); /* Slightly enlarge on hover */
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.7); /* Enhanced shadow on hover */
            border-color: #26a69a; /* Teal border color on hover */
        }
        
        .status-image {
            position: absolute;
            top: 10px;
            right: 10px;
            display: none;
            width: 24px;
            height: 24px;
        }
        
        .buttons-row {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
        }
        
        .buttons-row .download-button,
        .buttons-row .submit-button {
            flex: 1;
            margin: 0 5px;
            padding: 10px;
            font-size: 1em;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.3s, box-shadow 0.3s;
        }
        
        .buttons-row .download-button {
            background-color: #26a69a; /* Teal background for download */
            color: white;
        }
        
        .buttons-row .download-button:hover {
            background-color: #00796b; /* Darker teal on hover */
            transform: translateY(-3px); /* Lift up effect on hover */
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.4); /* Enhanced shadow on hover */
        }
        
        .buttons-row .submit-button {
            background-color: #4caf50; /* Green background for submit */
            color: white;
        }
        
        .buttons-row .submit-button:hover {
            background-color: #388e3c; /* Darker green on hover */
            transform: translateY(-3px); /* Lift up effect on hover */
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.4); /* Enhanced shadow on hover */
        }
        
        .hint-button {
            margin-top: 10px;
            padding: 10px;
            background-color: #009688; /* Teal background for hint */
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.3s, box-shadow 0.3s;
        }
        
        .hint-button:hover {
            background-color: #00796b; /* Darker teal on hover */
            transform: translateY(-3px); /* Lift up effect on hover */
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.4); /* Enhanced shadow on hover */
        }
        
        .hint-button:disabled {
            background-color: #607d8b;
            cursor: not-allowed;
        }
        
        .error-message {
            color: #ff5252; /* Red color for error messages */
            font-weight: bold;
            margin-top: 10px;
        }
        
        .hint {
            margin-top: 10px;
            font-style: italic;
        }
        
        .total-points {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #1c1c1c;
            color: #26a69a; /* Teal color for points */
            padding: 15px 20px;
            border-radius: 8px;
            font-size: 1.2em;
            font-weight: bold;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
            transition: background-color 0.3s, box-shadow 0.3s;
        }
        
        .total-points:hover {
            background-color: #121212; /* Darker background on hover */
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.7); /* Enhanced shadow on hover */
        }
        
        .tag {
            display: inline-block;
            padding: 4px 8px;
            margin: 2px;
            background-color: #333;
            border: 1px solid #444;
            border-radius: 4px;
            color: #e0e0e0;
            font-size: 0.9em;
        }
        
        .tags-container {
            margin-top: 10px;
        }
          
    </style>
</head>
<body>
    <div class="container">
        <h1>CTF Challenges</h1>

        <!-- Challenges will be dynamically generated here -->
    </div>

    <div class="total-points">
        Total Points: <span id="total-points">0</span>
    </div>

    <script>
            const flags = [
                'ctf{thequickbrowndogoverjumpslazyfox}', 'byuctf{charlie_the_fish_was_a_spy_too}', 'byuctf{so_thats_what_those_files_are_for__adec60bd}', 'ctf{digital_forensics_is_my_favorite}',
                'byuctf{even_w1th_the_l1ttlest_of_1nfo_1_can_reconstruct_1t}'
            ];
        
            const points = new Array(15).fill(30);
        
            const fileNames = [
                'secret.txt', 'charliethefish.jpg', 'leak_final.tar.zip', 'forensics-flag2.zip', 
                'reconstruct.png'
            ];
            
            const descriptions = [
                `I discovered a phenomenon called "Getting to Philosophy" in Wikipedia - [read up about it](https://en.Wikipedia.org/wiki/Wikipedia:Getting_to_Philosophy) if you don't know what it is. I realized I could use this to send secret messages. <br>
                *Note - "first link in the main text of an English Wikipedia article" means we don't count disambiguations, pronunciations, redirects, words in parentheses or italics, sound clips, citations, template messages, or table of contents as the "first link"*<br>
                Flag format - ctf{phrase} `,
                "FISHüêü", 
                "Can you find the flag in these files?", 
                "How good are you at password cracking?", 
                `To prevent the need to brute force submit what may seem to be multiple likely answers, I have provided the MD5 hash of the entire flag so you can verify that you have it right before submitting it online (lessening load on the server)<br>
                63b1424fa6fe8aa81d9ce4b5637f7acd`,


            ];
            
            const hints = [
                "U have to reach the Philosophy or u can use https://github.com/Mohamed2del/Getting_into_Philosohpy", 
                "Try every tool u got man which starts with S", 
                ".DS Store",
                'What did we use to crack password the last round?? ',
                'Just become obsessed with the endings of the characters? Zoom in really far? And overthink your life?',
            ];
            
            const tags = [
                ['Cryptography', 'Hard'],
                ['Stegnography',  'easy'], 
                ['secretfile', 'zip', `search`],
                ['password', 'jacktheripper', 'medium'], 
                ['reconstruct', 'password'],
            ];
            
            let totalPoints = parseInt(sessionStorage.getItem('totalPoints')) || 0;
            const completedChallenges = new Set(JSON.parse(sessionStorage.getItem('completedChallenges')) || []);
            const teamName = sessionStorage.getItem('teamName') || prompt('Enter your team name:');
            sessionStorage.setItem('teamName', teamName);
        
            document.getElementById('total-points').textContent = totalPoints;
        
            // Dynamically generate challenge HTML with tick image
            const container = document.querySelector('.container');
            const tickImageSrc = 'tick.png'; // Path to your tick image
            for (let i = 0; i < 5; i++) {
                const challengeDiv = document.createElement('div');
                challengeDiv.className = 'challenge';
                challengeDiv.id = `challenge${i + 1}`;
        
                const tagsHTML = tags[i].map(tag => `<span class="tag">${tag}</span>`).join(' ');
        
                challengeDiv.innerHTML = `
                    <h2>Challenge ${i + 1}</h2>
                    <p>${descriptions[i]}</p>
                    <div class="tags-container">${tagsHTML}</div>
                    <input type="text" placeholder="flag{your_flag}" class="flag-input" value="${sessionStorage.getItem(`flagInput${i}`) || ''}">
                    <div class="buttons-row">
                        <a href="files/${fileNames[i]}" download="${fileNames[i]}" class="download-button">Download File</a>
                        <button onclick="checkFlag(${i}, event)" class="submit-button">Submit Flag</button>
                    </div>
                    <button onclick="showHint(${i})" class="hint-button">Hint</button>
                    <p class="hint" id="hint${i}">${hints[i]}</p>
                    <p class="error-message"></p>
                    <img src="${tickImageSrc}" alt="Completed" class="status-image" id="status${i}">
                `;
        
                container.appendChild(challengeDiv);
            }
        
            function checkFlag(challengeIndex, event) {
                event.preventDefault();
        
                const challenge = document.getElementsByClassName('challenge')[challengeIndex];
                const input = challenge.getElementsByClassName('flag-input')[0];
                const errorMessage = challenge.getElementsByClassName('error-message')[0];
                const button = challenge.getElementsByClassName('submit-button')[0];
                const statusImage = challenge.querySelector('.status-image');
                const hintButton = challenge.getElementsByClassName('hint-button')[0];
        
                if (input.value === flags[challengeIndex]) {
                    if (!completedChallenges.has(challengeIndex)) {
                        totalPoints += points[challengeIndex];
                        document.getElementById('total-points').textContent = totalPoints;
                        completedChallenges.add(challengeIndex);
                        sessionStorage.setItem('totalPoints', totalPoints);
                        sessionStorage.setItem('completedChallenges', JSON.stringify(Array.from(completedChallenges)));
        
                        // Send points update to server
                        fetch('/scorecard/update', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({
                                teamName: teamName,
                                points: points[challengeIndex]
                            })
                        })
                        .then(response => {
                            if (!response.ok) {
                                throw new Error('Failed to update score');
                            }
                            return response.text();
                        })
                        .then(() => console.log('Score updated'))
                        .catch(error => console.error('Error:', error));
                    }
                    errorMessage.textContent = 'Correct flag!';
                    errorMessage.style.color = 'green';
                    input.disabled = true;
                    button.disabled = true;
                    hintButton.disabled = true; // Disable hint button as well
        
                    // Show tick image
                    statusImage.style.display = 'block';
                } else {
                    errorMessage.textContent = 'Wrong flag, try again.';
                    errorMessage.style.color = 'red';
                }
        
                // Store the input value
                sessionStorage.setItem(`flagInput${challengeIndex}`, input.value);
            }
        
            const revealedHints = new Set(JSON.parse(sessionStorage.getItem('revealedHints')) || []);
            function showHint(challengeIndex) {
                if (confirm("2 points shall be deducted on revealing the hint. Do you want to proceed?")) {
                    const hint = document.getElementById(`hint${challengeIndex}`);
                    hint.style.display = 'block';
                    const hintButton = document.getElementsByClassName('hint-button')[challengeIndex];
                    hintButton.disabled = true;
            
                    if (!revealedHints.has(challengeIndex)) {
                        totalPoints -= 2;
                        revealedHints.add(challengeIndex);
                        sessionStorage.setItem('revealedHints', JSON.stringify([...revealedHints]));
                    }
            
                    document.getElementById('total-points').textContent = totalPoints;
                    sessionStorage.setItem('totalPoints', totalPoints);
                    
                    // Send points update to server when hint is used
                    fetch('/scorecard/update', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            teamName: teamName,
                            points: -2 // Deduct 2 points for hint
                        })
                    })
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('Failed to update score');
                        }
                        return response.text();
                    })
                    .then(() => console.log('Score updated due to hint usage'))
                    .catch(error => console.error('Error:', error));
                }
            }
            
            function initializePage() {
                // Restore revealed hints
                revealedHints.forEach(index => {
                    const hint = document.getElementById(`hint${index}`);
                    hint.style.display = 'block';
                    const hintButton = document.getElementsByClassName('hint-button')[index];
                    hintButton.disabled = true;
                });
        
                // Restore status images for completed challenges
                completedChallenges.forEach(index => {
                    const input = document.getElementsByClassName('flag-input')[index];
                    const button = document.getElementsByClassName('submit-button')[index];
                    const statusImage = document.getElementById(`status${index}`);
                    const hintButton = document.getElementsByClassName('hint-button')[index];
        
                    input.disabled = true;
                    button.disabled = true;
                    hintButton.disabled = true; // Ensure hint button is disabled for completed challenges
                    statusImage.style.display = 'block';
                });
            }
        
            // Call the initialization function
            initializePage();

            
            document.addEventListener('contextmenu', function(e) {
                e.preventDefault();
            });
    
            // Disable specific keyboard shortcuts (e.g., F12, Ctrl+Shift+I, Ctrl+U)
            document.addEventListener('keydown', function(e) {
                // F12
                if (e.key === 'F12') {
                    e.preventDefault();
                }
                // Ctrl+Shift+I (Open Developer Tools)
                if (e.ctrlKey && e.shiftKey && e.key === 'I') {
                    e.preventDefault();
                }
                // Ctrl+U (View Source)
                if (e.ctrlKey && e.key === 'U') {
                    e.preventDefault();
                }
                // Ctrl+Shift+J (Open Console)
                if (e.ctrlKey && e.shiftKey && e.key === 'J') {
                    e.preventDefault();
                }
                // Ctrl+Shift+K (Open Console)
                if (e.ctrlKey && e.shiftKey && e.key === 'K') {
                    e.preventDefault();
                }
            });
    
            // Detect and block the F12 key for Developer Tools
            window.addEventListener('keydown', function(e) {
                if (e.key === 'F12') {
                    e.preventDefault();
                    return false;
                }
            });
    
            // Disable the ability to open the DevTools on right-click
            document.addEventListener('contextmenu', function(e) {
                e.preventDefault();
                return false;
            });
        </script>
    
</body>
</html>
